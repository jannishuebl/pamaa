// Auto-generated from page.html.
// DO NOT EDIT.

library page_controller;

import 'dart:html' as autogenerated;
import 'dart:svg' as autogenerated_svg;
import 'package:web_ui/web_ui.dart' as autogenerated;
import 'package:web_ui/observe/observable.dart' as __observe;
import 'dart:html';
import 'package:web_ui/web_ui.dart';
import 'dart:js';
import '../../controller.dart';
import '../../util/util.dart' as util;
import 'package:ams/aes/uuid.dart';
import '../page/folder-overview.dart';
import '../page/account-overview.dart';
import '../page/add-account.dart';
import '../page/show-account.dart';
import '../page/show-settings.dart';



/** Die Klasse ist das Model zum Seiteninhalt übergebene Seiten zeigt es an.
 *  Außerdem ist sie für die History verantwortlich.
 *
 * **/
class PageComponent extends WebComponent {
  /** Autogenerated from the template. */

  autogenerated.ScopedCssMapper _css;

  /** This field is deprecated, use getShadowRoot instead. */
  get _root => getShadowRoot("page-section");
  static final __shadowTemplate = new autogenerated.DocumentFragment.html('''
      ''', treeSanitizer: autogenerated.nullTreeSanitizer);
  autogenerated.Template __t;

  void created_autogenerated() {
    var __root = createShadowRoot("page-section");
    setScopedCss("page-section", new autogenerated.ScopedCssMapper({"page-section":"[is=\"page-section\"]"}));
    _css = getScopedCss("page-section");
    __t = new autogenerated.Template(__root);
    __root.nodes.add(__shadowTemplate.clone(true));
    __t.create();
  }

  void inserted_autogenerated() {
    __t.insert();
  }

  void removed_autogenerated() {
    __t.remove();
    __t = null;
  }

  /** Original code from the component. */


  final String contentPage = '#mainPageRegion';
  final String titel = "password4u";
  // All url that matches pages/blabla are redirectet to /
  final String pathToPages = "pages/";
  bool ini = false;
bool statePushed = false;
  PageComponent() {
    // is needed because there are problem wenn the user logsout and relogin again
    new Controller().pageComp = this;

    context['History'].Adapter.bind(context['window'],'statechange', new JsObject.fromBrowserObject((_){ 
          if(!statePushed) {
          var State = context['History'].getState(); 
          int url = State.data.url;
         var page =  getPage(path:url);
    page..host = new DivElement();
    // erst zum lifecycle hinzufügen dann zum pagestack hinzufügen
    util.addComponent(query(contentPage), page, true);
          }
          statePushed = false;
          }));
  }

  /** Zeigt eine seite an. **/
  void loadePage(WebPage page) {     

    page..host = new DivElement();
    // erst zum lifecycle hinzufügen dann zum pagestack hinzufügen
    util.addComponent(query(contentPage), page, true);
    // prüfen ob keine Url angehängt ist. also ob nur sie nur mit domain/ endet.
    // wenn dem so ist wird der Status erstetzt und nicht ein neuer Hinzugefügt
    statePushed = true;
    var State = context['History'].getState(); 
    if(State.hash.compareTo('/') != 0) {
      //print('pushState');
      context['History'].pushState(new JsObject.fromBrowserObject({"url":pathToPages + page.getPageUrl() }), titel, "https://localhost:8443/"+pathToPages + page.getPageUrl()); 
    } else {
      //print('replaceState');
      context['History'].replaceState(new JsObject.fromBrowserObject({"url":pathToPages + page.getPageUrl() }), titel, pathToPages + page.getPageUrl()); 
    }}

  void pageBack() {

    window.history.back();

  }
  void reset() {
    context['History'].pushState(new JsObject.fromBrowserObject({"url":'/'}), titel, "/"); 
  }

  WebPage getPage({var path:null}) {
//print(window.location.pathname);

    if(path == null) path = window.location.pathname.trim().split("/");
    else path = path.trim().split("/");
    var page;
    if(path[0].compareTo("") == 0) path.removeAt(0);
    if(path.contains("pages")) {
      //print(path[0]);
      page = path[1];
    }
    if(page != null) {
      if(page.compareTo(AccountOverview.pageUrl) == 0) {
        return new AccountOverview(int.parse(path[2]));
      }
      if(page.compareTo(AddAccountComponent.pageUrl) == 0) {
        return new AddAccountComponent();
      }
      if(page.compareTo(FolderOverview.pageUrl) == 0) {
        return new FolderOverview();
      }
      if(page.compareTo(ShowAccountComponent.pageUrl) == 0) {
      return new ShowAccountComponent()..data= new Controller().data.account.firstWhere((e) { return e.data.id == int.parse(path[2]);}).data;
      }
      if(page.compareTo(ShowSettingsComponent.pageUrl) == 0) {
        return new ShowSettingsComponent();
      }
    }
    return new FolderOverview();
  }
}

//# sourceMappingURL=page-controller.dart.map